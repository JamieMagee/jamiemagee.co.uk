<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><link href=https://gmpg.org/xfn/11 rel=profile><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Writing GitHub bots in .NET &#183; Jamie Magee</title><link rel=preload href=/css/poole.css as=style><link rel=preload href=/css/hyde.css as=style><link rel=preload href=/css/poole-overrides.css as=style><link rel=preload href=/css/hyde-overrides.css as=style><link rel=preload href=/css/hyde-x.css as=style><link rel=preload href=/fonts/BerkeleyMono-Regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" as=style crossorigin><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css as=style crossorigin><link rel=preload href=https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1/lite-youtube.min.js as=script crossorigin><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/hyde.css><link rel=stylesheet href=/css/poole-overrides.css><link rel=stylesheet href=/css/hyde-overrides.css><link rel=stylesheet href=/css/hyde-x.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" crossorigin><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css crossorigin><style>@font-face{font-family:berkeley mono;src:url(/fonts/BerkeleyMono-Regular.woff2)format('woff2');font-display:swap}.lite-youtube-fallback{aspect-ratio:16/9;display:flex;justify-content:center;align-items:center;flex-direction:column;gap:1em;padding:1em;background-color:#000;color:#fff;text-decoration:none;border-radius:8px;transition:background-color .2s ease}.lite-youtube-fallback:hover{background-color:#333;color:#fff}.lite-youtube-fallback::before{display:block;content:'';border:solid transparent;border-width:2em 0 2em 3em;border-left-color:red;transition:border-left-color .2s ease}.lite-youtube-fallback:hover::before{border-left-color:#fff}.lite-youtube-fallback:focus{outline:2px solid red;outline-offset:2px}</style><link rel=stylesheet href=/css/jamie.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><meta name=description content><meta name=keywords content><meta name=author content="Jamie Magee"><meta name=robots content="index, follow"><link rel=canonical href=/blog/writing-github-bots-in-net/><meta property="og:url" content="/blog/writing-github-bots-in-net/"><meta property="og:site_name" content="Jamie Magee"><meta property="og:title" content="Writing GitHub bots in .NET"><meta property="og:description" content="For a while now the Octokit libraries for .NET have lagged behind the JavaScript libraries, especially when it comes to webhooks. Unfortunately, I needed a GitHub webhook client for an internal project, so I had to write my own. It wasn’t too much extra effort to open source it, and thus Octokit.Webhooks was born!
I wanted to give a quick example of how to get up and running with Octokit.Webhooks, and what better way than to write a small GitHub bot?"><meta property="og:locale" content="en_gb"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-03-04T05:40:46+00:00"><meta property="article:modified_time" content="2022-03-04T05:40:46+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Writing GitHub bots in .NET"><meta name=twitter:description content="For a while now the Octokit libraries for .NET have lagged behind the JavaScript libraries, especially when it comes to webhooks. Unfortunately, I needed a GitHub webhook client for an internal project, so I had to write my own. It wasn’t too much extra effort to open source it, and thus Octokit.Webhooks was born!
I wanted to give a quick example of how to get up and running with Octokit.Webhooks, and what better way than to write a small GitHub bot?"><script type=module src=https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1/lite-youtube.min.js></script></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><div class=sidebar-head><h1><a href=/>Jamie Magee</a></h1></div><p class=lead>Programmer, Engineer, Problem Solver</p></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>Home</a></li><li class=sidebar-nav-item><a href=/about>About</a></li><li class=sidebar-nav-item><a href=/blog>Archive</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/JamieMagee><i class="fa-brands fa-github-square fa-3x"></i></a>
<a href=https://bsky.app/profile/jamiemagee.bsky.social><i class="fa-brands fa-square-bluesky fa-3x"></i></a>
<a href=https://www.linkedin.com/in/jamiemagee1/><i class="fa-brands fa-linkedin fa-3x"></i></a>
<a href=/index.xml type=application/rss+xml><i class="fa-solid fa-rss-square fa-3x"></i></a></li></ul><p>&copy; 2025. <a href=https://creativecommons.org/licenses/by-nc/4.0/>CC BY-NC 4.0</a></p></div></div><div class="content container"><div class=post><h1 class=post-title>Writing GitHub bots in .NET</h1><span class=post-date>Mar 4, 2022 &#183; 5 minute read</span><p>For a while now the Octokit libraries for .NET have lagged behind the JavaScript libraries, especially when it comes to webhooks. Unfortunately, I needed a GitHub webhook client for an internal project, so I had to write my own. It wasn’t too much extra effort to open source it, and thus <a href=https://github.com/octokit/webhooks.net>Octokit.Webhooks</a> was born!</p><p>I wanted to give a quick example of how to get up and running with <code>Octokit.Webhooks</code>, and what better way than to write a small GitHub bot?</p><h2 id=setup>Setup</h2><p>For this project, I’m going to be using <a href=https://dotnet.microsoft.com/en-us/download/dotnet/6.0>.NET 6.0</a> and <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis?view=aspnetcore-6.0">ASP.NET’s new minimal APIs</a> to simplify setup. From a terminal I’m going to create a new web API project:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>dotnet new webapi --output octokit-webhooks-sample
</span></span></code></pre></div><p>The default template is set up to be a weather forecast API, but I can simplify it a bit more for this sample. My <code>Program.cs</code> looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cs data-lang=cs><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>var</span> builder <span style=color:#1f2328>=</span> WebApplication<span style=color:#1f2328>.</span>CreateBuilder<span style=color:#1f2328>(</span>args<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#cf222e>var</span> app <span style=color:#1f2328>=</span> builder<span style=color:#1f2328>.</span>Build<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>app<span style=color:#1f2328>.</span>Run<span style=color:#1f2328>();</span>
</span></span></code></pre></div><p>Next up I’m going to install the <a href=https://www.nuget.org/packages/Octokit.Webhooks.AspNetCore/>Octokit.Webhooks.AspNetCore</a> package:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>dotnet add package Octokit.Webhooks.AspNetCore
</span></span></code></pre></div><p>This package consumes the Octokit.Webhooks package, which contains core functionality like deserializers and processors, and adds ASP.NET Core specific code, like automatic API endpoint mapping and shared secret verification.</p><h2 id=handling-webhooks>Handling webhooks</h2><p>Now that I’ve got my project set up, I need to create my own processor to handle incoming webhooks. <code>Octokit.Webhooks</code> ships with an abstract class called <code>WebhookEventProcessor</code> that does all the heavy lifting of deserializing incoming webhooks. All I need to do is to create my own class that inherits from it, and write some logic to act on the webhook events.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cs data-lang=cs><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>using</span> <span style=color:#24292e>Octokit.Webhooks</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#cf222e>using</span> <span style=color:#24292e>Octokit.Webhooks.Events</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#cf222e>using</span> <span style=color:#24292e>Octokit.Webhooks.Events.IssueComment</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#cf222e>public</span> <span style=color:#cf222e>sealed</span> <span style=color:#cf222e>class</span> <span style=color:#1f2328>MyWebhookEventProcessor</span> <span style=color:#1f2328>:</span> WebhookEventProcessor
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>  <span style=color:#cf222e>private</span> <span style=color:#cf222e>readonly</span> ILogger<span style=color:#1f2328>&lt;</span>MyWebhookEventProcessor<span style=color:#1f2328>&gt;</span> logger<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>  <span style=color:#cf222e>public</span> MyWebhookEventProcessor<span style=color:#1f2328>(</span>ILogger<span style=color:#1f2328>&lt;</span>MyWebhookEventProcessor<span style=color:#1f2328>&gt;</span> logger<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>  <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span>logger <span style=color:#1f2328>=</span> logger<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>  <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>  <span style=color:#cf222e>protected</span> <span style=color:#cf222e>override</span> Task ProcessIssueCommentWebhookAsync<span style=color:#1f2328>(</span>WebhookHeaders headers<span style=color:#1f2328>,</span> IssueCommentEvent issueCommentEvent<span style=color:#1f2328>,</span> IssueCommentAction action<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>  <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span>logger<span style=color:#1f2328>.</span>LogInformation<span style=color:#1f2328>(</span>issueCommentEvent<span style=color:#1f2328>.</span>Comment<span style=color:#1f2328>.</span>Body<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#cf222e>return</span> Task<span style=color:#1f2328>.</span>CompletedTask<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>  <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>I created a small class <code>MyWebhookEventProcessor</code> that inherits from <code>WebhookEventProcessor</code>, and has an override for <code>ProcessIssueCommentWebhookAsync</code> that logs out the comment body. I also get the headers and the action passed to this method, so I could write a switch case and have different handling for created, edited, and deleted actions, but this is enough for now.</p><p>I also need to hook up <code>MyWebhookEventProcessor</code> in my startup class.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cs data-lang=cs><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>using</span> <span style=color:#24292e>Octokit.Webhooks</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#cf222e>using</span> <span style=color:#24292e>Octokit.Webhooks.AspNetCore</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#cf222e>var</span> builder <span style=color:#1f2328>=</span> WebApplication<span style=color:#1f2328>.</span>CreateBuilder<span style=color:#1f2328>(</span>args<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>builder<span style=color:#1f2328>.</span>Services<span style=color:#1f2328>.</span>AddSingleton<span style=color:#1f2328>&lt;</span>WebhookEventProcessor<span style=color:#1f2328>,</span> MyWebhookEventProcessor<span style=color:#1f2328>&gt;();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#cf222e>var</span> app <span style=color:#1f2328>=</span> builder<span style=color:#1f2328>.</span>Build<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>app<span style=color:#1f2328>.</span>UseRouting<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>app<span style=color:#1f2328>.</span>UseEndpoints<span style=color:#1f2328>(</span>endpoints <span style=color:#1f2328>=&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>  endpoints<span style=color:#1f2328>.</span>MapGitHubWebhooks<span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#1f2328>});</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>app<span style=color:#1f2328>.</span>Run<span style=color:#1f2328>();</span>
</span></span></code></pre></div><p>This is enough to tell ASP.NET to hook up dependency injection for <code>MyWebhookEventProcessor</code>, enable routing. It will also automatically add a route to handle incoming GitHub webhooks. By default it’s exposed at <code>/api/github/webhooks</code>, but you can use any route you’d like. <code>MapGitHubWebhooks</code> also accepts a shared secret which allows you to verify the content signature of GitHub webhooks.</p><p>That’s all the code required on my side. Now I just need to expose my service to the internet, and configure GitHub to start sending me webhooks.</p><h2 id=github-webhook-configuration>GitHub webhook configuration</h2><p>For GitHub to be able to send me webhooks, my service needs to be publicly accessible to the internet. I recently discovered a neat little service to do this with nothing more than ssh: <a href=https://localhost.run/>localhost.run</a>.</p><p>If I run my app with <code>dotnet run</code> then I can find the port that it’s running on:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>info: Microsoft.Hosting.Lifetime[14]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>      Now listening on: http://localhost:5002
</span></span></code></pre></div><p>And using <a href=http://localhost.run>localhost.run</a> I can create a tunnel for that port:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ ssh -R 80:localhost:5002 nokey@localhost.run
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>b49b69845954b1.lhrtunnel.link tunneled with tls termination, https://b49b69845954b1.lhrtunnel.link
</span></span></code></pre></div><p>Now on GitHub if I visit the settings for a repository, and go to webhooks, I can create a new webhook configuration using that domain name.</p><p><img src=/img/github-new-webhook.png alt="Creating a new GitHub Webhook"></p><p>Now all I need to do is create a comment on an issue in the same repository&mldr;.</p><p><img src=/img/new-github-comment.png alt="A test issue comment"></p><p>And it’ll get logged in my terminal!</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>info: MyWebhookEventProcessor[0]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>      Test comment
</span></span></code></pre></div><h2 id=making-it-interactive>Making it interactive</h2><p>Logging things to the terminal is great and all, but to make it a bot it should really <em>do</em> something. For that I’ll need the <code>Octokit</code> package:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>dotnet add package Octokit
</span></span></code></pre></div><p>And I’ll use it in <code>MyWebhookEventProcessor</code> :</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cs data-lang=cs><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#cf222e>private</span> <span style=color:#cf222e>readonly</span> GitHubClient client<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#cf222e>public</span> MyWebhookEventProcessor<span style=color:#1f2328>(</span>ILogger<span style=color:#1f2328>&lt;</span>MyWebhookEventProcessor<span style=color:#1f2328>&gt;</span> logger<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span>logger <span style=color:#1f2328>=</span> logger<span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>  <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span>client <span style=color:#1f2328>=</span> <span style=color:#cf222e>new</span> GitHubClient<span style=color:#1f2328>(</span><span style=color:#cf222e>new</span> ProductHeaderValue<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;octokit-webhooks-sample&#34;</span><span style=color:#1f2328>))</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    Credentials <span style=color:#1f2328>=</span> <span style=color:#cf222e>new</span> Credentials<span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;...&#34;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  <span style=color:#1f2328>};</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>For this example I’m using a personal access token. You can create your own <a href=https://github.com/settings/tokens>here</a>. If I were deploying this as a production service, I would probably use something a bit more robust, like a <a href=https://docs.github.com/en/developers/apps/building-github-apps/authenticating-with-github-apps>GitHub App</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-cs data-lang=cs><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#cf222e>protected</span> <span style=color:#cf222e>override</span> <span style=color:#cf222e>async</span> Task ProcessIssueCommentWebhookAsync<span style=color:#1f2328>(</span>WebhookHeaders headers<span style=color:#1f2328>,</span> IssueCommentEvent issueCommentEvent<span style=color:#1f2328>,</span> IssueCommentAction action<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>  <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span>logger<span style=color:#1f2328>.</span>LogInformation<span style=color:#1f2328>(</span>issueCommentEvent<span style=color:#1f2328>.</span>Comment<span style=color:#1f2328>.</span>Body<span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  <span style=color:#cf222e>await</span> <span style=color:#cf222e>this</span><span style=color:#1f2328>.</span>client<span style=color:#1f2328>.</span>Issue<span style=color:#1f2328>.</span>Comment<span style=color:#1f2328>.</span>Create<span style=color:#1f2328>(</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    repositoryId<span style=color:#1f2328>:</span> issueCommentEvent<span style=color:#1f2328>.</span>Repository<span style=color:#1f2328>.</span>Id<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    number<span style=color:#1f2328>:</span> <span style=color:#1f2328>(</span><span style=color:#cf222e>int</span><span style=color:#1f2328>)</span>issueCommentEvent<span style=color:#1f2328>.</span>Issue<span style=color:#1f2328>.</span>Number<span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    newComment<span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;Hello, world!&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>  <span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>I need to do that cast from <code>long</code> to <code>int</code> because <code>Octokit</code> still has <a href=https://github.com/octokit/octokit.net/pull/2352>an open PR</a> to convert all its IDs to <code>long</code>. I’ve also got to add the <code>async</code> modifier to my method, so I can <code>await</code> the issue comment creation method in Octokit.</p><p>Once I’ve done all that, I can create an issue comment on my repository on GitHub and my “bot” will reply!</p><p><img src=/img/github-bot-reply.png alt="A reply from the bot"></p><h2 id=what-next>What next?</h2><p>If you find the library useful or interesting, give it <a href=https://github.com/octokit/webhooks.net>a star on GitHub</a>. And create an issue or pull request if you find find a bug or have a feature request.</p><p>If you want to create a fully-fledged bot, check out the GitHub documentation on creating a <a href=https://docs.github.com/en/developers/apps/building-github-apps/creating-a-github-app>GitHub app</a>. It’s the next progression from PATs, and allows you to more easily share your bot.</p></div></div></body></html>