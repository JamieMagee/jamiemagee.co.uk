<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><link href=https://gmpg.org/xfn/11 rel=profile><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Maintaining AUR packages with Renovate &#183; Jamie Magee</title><link rel=preload href=/css/poole.css as=style><link rel=preload href=/css/hyde.css as=style><link rel=preload href=/css/poole-overrides.css as=style><link rel=preload href=/css/hyde-overrides.css as=style><link rel=preload href=/css/hyde-x.css as=style><link rel=preload href=/fonts/BerkeleyMono-Regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" as=style crossorigin><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css as=style crossorigin><link rel=preload href=https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1/lite-youtube.min.js as=script crossorigin><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/hyde.css><link rel=stylesheet href=/css/poole-overrides.css><link rel=stylesheet href=/css/hyde-overrides.css><link rel=stylesheet href=/css/hyde-x.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" crossorigin><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css crossorigin><style>@font-face{font-family:berkeley mono;src:url(/fonts/BerkeleyMono-Regular.woff2)format('woff2');font-display:swap}.lite-youtube-fallback{aspect-ratio:16/9;display:flex;justify-content:center;align-items:center;flex-direction:column;gap:1em;padding:1em;background-color:#000;color:#fff;text-decoration:none;border-radius:8px;transition:background-color .2s ease}.lite-youtube-fallback:hover{background-color:#333;color:#fff}.lite-youtube-fallback::before{display:block;content:'';border:solid transparent;border-width:2em 0 2em 3em;border-left-color:red;transition:border-left-color .2s ease}.lite-youtube-fallback:hover::before{border-left-color:#fff}.lite-youtube-fallback:focus{outline:2px solid red;outline-offset:2px}</style><link rel=stylesheet href=/css/jamie.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><meta name=description content><meta name=keywords content><meta name=author content="Jamie Magee"><meta name=robots content="index, follow"><link rel=canonical href=/blog/maintaining-aur-packages-with-renovate/><meta property="og:url" content="/blog/maintaining-aur-packages-with-renovate/"><meta property="og:site_name" content="Jamie Magee"><meta property="og:title" content="Maintaining AUR packages with Renovate"><meta property="og:description" content="One big advantage that Arch Linux has over other distributions, apart from being able to say “BTW I use Arch.”, is the Arch User Repository (AUR). It’s a community-driven repository with over 80,000 packages. If you’re looking for a package, chances are you’ll find it in the AUR.
Keeping all those packages up to date, takes a lot of manual effort by a lot of volunteers. People have created and used tools, like urlwatch and aurpublish, to let them know when upstream releases are cut and automate some parts of the process. I know I do. But I wanted to automate the entire process. I think Renovate can help here."><meta property="og:locale" content="en_gb"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-03-16T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-16T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Maintaining AUR packages with Renovate"><meta name=twitter:description content="One big advantage that Arch Linux has over other distributions, apart from being able to say “BTW I use Arch.”, is the Arch User Repository (AUR). It’s a community-driven repository with over 80,000 packages. If you’re looking for a package, chances are you’ll find it in the AUR.
Keeping all those packages up to date, takes a lot of manual effort by a lot of volunteers. People have created and used tools, like urlwatch and aurpublish, to let them know when upstream releases are cut and automate some parts of the process. I know I do. But I wanted to automate the entire process. I think Renovate can help here."><script type=module src=https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1/lite-youtube.min.js></script></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><div class=sidebar-head><h1><a href=/>Jamie Magee</a></h1></div><p class=lead>Programmer, Engineer, Problem Solver</p></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>Home</a></li><li class=sidebar-nav-item><a href=/about>About</a></li><li class=sidebar-nav-item><a href=/blog>Archive</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/JamieMagee><i class="fa-brands fa-github-square fa-3x"></i></a>
<a href=https://bsky.app/profile/jamiemagee.bsky.social><i class="fa-brands fa-square-bluesky fa-3x"></i></a>
<a href=https://www.linkedin.com/in/jamiemagee1/><i class="fa-brands fa-linkedin fa-3x"></i></a>
<a href=/index.xml type=application/rss+xml><i class="fa-solid fa-rss-square fa-3x"></i></a></li></ul><p>&copy; 2025. <a href=https://creativecommons.org/licenses/by-nc/4.0/>CC BY-NC 4.0</a></p></div></div><div class="content container"><div class=post><h1 class=post-title>Maintaining AUR packages with Renovate</h1><span class=post-date>Mar 16, 2023 &#183; 5 minute read</span><p>One big advantage that Arch Linux has over other distributions, apart from being able to say “BTW I use Arch.”, is the Arch User Repository (AUR). It’s a community-driven repository with over 80,000 packages. If you’re looking for a package, chances are you&rsquo;ll find it in the AUR.</p><p>Keeping all those packages up to date, takes a lot of manual effort by a lot of volunteers. People have created and used tools, like <a href=https://github.com/thp/urlwatch><code>urlwatch</code></a> and <a href=https://github.com/eli-schwartz/aurpublish><code>aurpublish</code></a>, to let them know when upstream releases are cut and automate some parts of the process. I know I do. But I wanted to automate the entire process. I think <a href=https://github.com/renovatebot/renovate/>Renovate</a> can help here.</p><h2 id=updating-versions-with-renovate>Updating versions with Renovate</h2><p>Renovate is an automated dependency update tool. You might have seen it opening pull requests on GitHub and making updates for npm or other package managers, but it’s a lot more powerful than just that.</p><p>Renovate has a couple of concepts that I need to explain first: <a href=https://docs.renovatebot.com/modules/datasource>datasources</a> and <a href=https://docs.renovatebot.com/modules/manager/>managers</a>. Datasources define where to look for new versions of a dependency. Renovate comes with over 50 different datasources, but the one that is important for AUR packages is the <a href=https://docs.renovatebot.com/modules/datasource/#git-tags-datasource><code>git-tags</code> datasource</a>. Managers are the Renovate concept for package managers. There isn’t an AUR or <code>PKGBUILD</code> manager, but there is a <a href=https://docs.renovatebot.com/modules/manager/regex/>regex manager</a> that I can use.</p><p>I can create a <code>renovate.json</code> configuration with the following regex manager configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  <span style=color:#0550ae>&#34;regexManagers&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>      <span style=color:#0550ae>&#34;fileMatch&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span><span style=color:#0a3069>&#34;(^|/)PKGBUILD$&#34;</span><span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>      <span style=color:#0550ae>&#34;matchStrings&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        <span style=color:#0a3069>&#34;pkgver=(?&lt;currentValue&gt;.*) # renovate: datasource=(?&lt;datasource&gt;.*) depName=(?&lt;depName&gt;.*)&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>      <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>      <span style=color:#0550ae>&#34;extractVersionTemplate&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;^v?(?&lt;version&gt;.*)$&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>  <span style=color:#1f2328>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>Breaking that down:</p><ul><li>The <code>fileMatch</code> setting tells Renovate to look for any <code>PKGBUILD</code> files in a repository</li><li>The <code>matchStrings</code> is the regex format to extract the version, datasource, and dependency name from the <code>PKGBUILD</code></li><li>The <code>extractVersionTemplate</code> is to handle a “v” in front of any version number that is sometimes added to Git tags</li></ul><p>And here’s an extract from the PKGBUILD for the <a href=https://aur.archlinux.org/packages/bicep-bin>bicep-bin</a> AUR package that I maintain:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#953800>pkgver</span><span style=color:#0550ae>=</span>0.15.31 <span style=color:#57606a># renovate: datasource=github-tags depName=Azure/bicep</span>
</span></span></code></pre></div><p>Here I’m configuring Renovate to use the <a href=https://docs.renovatebot.com/modules/datasource/github-tags/><code>github-tags</code></a> datasource and to look in the <a href=https://github.com/Azure/bicep><code>Azure/bicep</code> GitHub repository</a> for new versions. That means it’ll look in the <a href=https://github.com/Azure/bicep/tags>list of tags for the <code>Azure/bicep</code> repository</a> for any new versions. If Renovate finds any new versions, it’ll automatically update the <code>PKGBUILD</code> and open a pull request with the updated version.</p><p>So I’ve automated the <code>PKGBUILD</code> update, but that’s only half of the work. The checksums and <code>.SRCINFO</code> must be updated before pushing to the AUR. Unfortunately, Renovate can’t do that (yet, see <a href=https://github.com/renovatebot/renovate/issues/16923>Renovate issue #16923</a>), but GitHub Actions can!</p><h2 id=updating-checksums-and-srcinfo-with-github-actions>Updating checksums and <code>.SRCINFO</code> with GitHub Actions</h2><p>Updating the checksums with <code>updpkgsums</code> is easy, and generating an updated <code>.SRCINFO</code> with <code>makepkg --printsrcinfo > .SRCINFO</code> is straightforward too. But doing that for a whole repository of AUR packages is going to be a little trickier. So let me build up the GitHub actions workflow step-by-step.</p><p>First, I only want to run this workflow on pull requests targeting the <code>main</code> branch.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0550ae>on</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span><span style=color:#0550ae>pull_request</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>    </span><span style=color:#0550ae>types</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff>      </span>- opened<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>      </span>- synchronize<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#fff>    </span><span style=color:#0550ae>branches</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#fff>      </span>- main<span style=color:#fff>
</span></span></span></code></pre></div><p>Next, I’m going to need to check out the entire history of the repository, so I can compare the files changed in the latest commit with the Git history.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0550ae>jobs</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span><span style=color:#0550ae>updpkgsums</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>    </span><span style=color:#0550ae>runs-on</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>ubuntu-latest<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff>    </span><span style=color:#0550ae>steps</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>      </span>- <span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Checkout<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#fff>        </span><span style=color:#0550ae>uses</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>actions/checkout@ac593985615ec2ede58e132d2e21d2b1cbd6127c<span style=color:#fff> </span><span style=color:#57606a># v3.3.0</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#fff>        </span><span style=color:#0550ae>with</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#fff>          </span><span style=color:#0550ae>fetch-depth</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0550ae>0</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#fff>          </span><span style=color:#0550ae>ref</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ github.ref }}<span style=color:#fff>
</span></span></span></code></pre></div><p>Getting the package that changed in a pull request requires a little bit of shell magic.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>- <span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Find updated package<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span><span style=color:#0550ae>run</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#1f2328>|</span><span style=color:#0a3069>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#0a3069>    #!/usr/bin/env bash
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#0a3069>    set -euxo pipefail
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#0a3069>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#0a3069>    echo &#34;pkgbuild=$(git diff --name-only origin/main origin/${GITHUB_HEAD_REF} &#34;*PKGBUILD&#34; | head -1 | xargs dirname)&#34; &gt;&gt; $GITHUB_ENV</span><span style=color:#fff>
</span></span></span></code></pre></div><p>Now I’ve found the package that changed in the Renovate pull request, I can update the files.</p><p>This step in the workflow uses a private GitHub Action that I have in my <code>aur-packages</code> repository. I’m not going to break it down here, but at its core it runs <code>updpkgsums</code> and <code>makepkg --printsrcinfo > .SRCINFO</code> with a little extra configuration required to run Arch Linux on GitHub Actions runners. You can <a href=https://github.com/JamieMagee/aur-packages/tree/main/.github/actions/aur>check out the full code on GitHub</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>- <span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Validate package<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span><span style=color:#0550ae>if</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ env.pkgbuild != &#39;&#39; }}<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>  </span><span style=color:#0550ae>uses</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>./.github/actions/aur<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff>  </span><span style=color:#0550ae>with</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>    </span><span style=color:#0550ae>action</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#39;updpkgsums&#39;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#fff>    </span><span style=color:#0550ae>pkgname</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ env.pkgbuild }}<span style=color:#fff>
</span></span></span></code></pre></div><p>Finally, once the <code>PKGBUILD</code> and <code>.SRCINFO</code> are updated I need to commit that change back to the pull request.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>- <span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Commit<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span><span style=color:#0550ae>if</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ env.pkgbuild != &#39;&#39; }}<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>  </span><span style=color:#0550ae>uses</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>stefanzweifel/git-auto-commit-action@3ea6ae190baf489ba007f7c92608f33ce20ef04a<span style=color:#fff> </span><span style=color:#57606a># v4.16.0</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff>  </span><span style=color:#0550ae>with</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>    </span><span style=color:#0550ae>file_pattern</span><span style=color:#1f2328>:</span><span style=color:#fff> </span><span style=color:#0a3069>&#39;*/PKGBUILD */.SRCINFO&#39;</span><span style=color:#fff>
</span></span></span></code></pre></div><p>Check out <a href=https://github.com/JamieMagee/aur-packages/pull/62>this pull request for <code>bicep-bin</code></a> where Renovate opened a pull request, and my GitHub Actions workflow updated the <code>b2sums</code> in the <code>PKGBUILD</code> and updated the <code>.SRCINFO</code>.</p><p>But why stop there? Let’s talk about publishing.</p><h2 id=publishing-to-the-aur>Publishing to the AUR</h2><p>Each AUR package is its own Git repository. So to update a package in the AUR, I only need to push a new commit with the updated <code>PKGBUILD</code> and <code>.SRCINFO</code>. Thankfully, <a href=https://github.com/KSXGitHub>KSXGitHub</a> created the <a href=https://github.com/KSXGitHub/github-actions-deploy-aur><code>github-actions-deploy-aur</code> GitHub Action</a> to streamline the whole process.</p><p>If I create a new GitHub Actions workflow to publish to the AUR, I can reuse the first two steps from my previous workflow to check out the repository and find the updated package. Then all I need to do is to use the <code>github-actions-deploy-aur</code> GitHub Action:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>- <span style=color:#0550ae>name</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>Publish package<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span><span style=color:#0550ae>uses</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>KSXGitHub/github-actions-deploy-aur@065b6056b25bdd43830d5a3f01899d0ff7169819<span style=color:#fff> </span><span style=color:#57606a># v2.6.0</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>  </span><span style=color:#0550ae>if</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ env.pkgbuild != &#39;&#39; }}<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#fff>  </span><span style=color:#0550ae>with</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#fff>    </span><span style=color:#0550ae>pkgname</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ env.pkgbuild }}<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#fff>    </span><span style=color:#0550ae>pkgbuild</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ env.pkgbuild }}/PKGBUILD<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#fff>    </span><span style=color:#0550ae>commit_username</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ secrets.AUR_USERNAME }}<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#fff>    </span><span style=color:#0550ae>commit_email</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ secrets.AUR_EMAIL }}<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#fff>    </span><span style=color:#0550ae>ssh_private_key</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>${{ secrets.AUR_SSH_PRIVATE_KEY }}<span style=color:#fff>
</span></span></span></code></pre></div><h3 id=all-together-now>All together now</h3><p>If you own any AUR packages and want to automate some of the maintenance burden, check out <a href=https://github.com/JamieMagee/aur-packages-template/>my AUR packages template GitHub repository</a>. It contains all of the steps I showed in this blog post. And if you want to see how it works in practice, check out <a href=https://github.com/JamieMagee/aur-packages>my AUR packages GitHub repository</a>.</p></div></div></body></html>