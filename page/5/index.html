<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.152.2"><meta charset=utf-8><link href=https://gmpg.org/xfn/11 rel=profile><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Jamie Magee &#183; Programmer, Engineer, Problem Solver</title><link rel=preload href=/css/poole.css as=style><link rel=preload href=/css/hyde.css as=style><link rel=preload href=/css/poole-overrides.css as=style><link rel=preload href=/css/hyde-overrides.css as=style><link rel=preload href=/css/hyde-x.css as=style><link rel=preload href=/fonts/BerkeleyMono-Regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" as=style crossorigin><link rel=preload href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css as=style crossorigin><link rel=preload href=https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1/lite-youtube.min.js as=script crossorigin><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/hyde.css><link rel=stylesheet href=/css/poole-overrides.css><link rel=stylesheet href=/css/hyde-overrides.css><link rel=stylesheet href=/css/hyde-x.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" crossorigin><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css crossorigin><style>@font-face{font-family:berkeley mono;src:url(/fonts/BerkeleyMono-Regular.woff2)format('woff2');font-display:swap}.lite-youtube-fallback{aspect-ratio:16/9;display:flex;justify-content:center;align-items:center;flex-direction:column;gap:1em;padding:1em;background-color:#000;color:#fff;text-decoration:none;border-radius:8px;transition:background-color .2s ease}.lite-youtube-fallback:hover{background-color:#333;color:#fff}.lite-youtube-fallback::before{display:block;content:'';border:solid transparent;border-width:2em 0 2em 3em;border-left-color:red;transition:border-left-color .2s ease}.lite-youtube-fallback:hover::before{border-left-color:#fff}.lite-youtube-fallback:focus{outline:2px solid red;outline-offset:2px}</style><link rel=stylesheet href=/css/jamie.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><link rel=alternate type=application/rss+xml href=/index.xml title="Jamie Magee"><meta name=description content><meta name=keywords content><meta name=author content="Jamie Magee"><meta name=robots content="index, follow"><link rel=canonical href=/><meta property="og:url" content="/"><meta property="og:site_name" content="Jamie Magee"><meta property="og:title" content="Jamie Magee"><meta property="og:locale" content="en_gb"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jamie Magee"><script type=module src=https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1/lite-youtube.min.js></script></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><div class=sidebar-head><h1><a href=/>Jamie Magee</a></h1></div><p class=lead>Programmer, Engineer, Problem Solver</p></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>Home</a></li><li class=sidebar-nav-item><a href=/about>About</a></li><li class=sidebar-nav-item><a href=/blog>Archive</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/JamieMagee><i class="fa-brands fa-github-square fa-3x"></i></a>
<a href=https://bsky.app/profile/jamiemagee.bsky.social><i class="fa-brands fa-square-bluesky fa-3x"></i></a>
<a href=https://www.linkedin.com/in/jamiemagee1/><i class="fa-brands fa-linkedin fa-3x"></i></a>
<a href=/index.xml type=application/rss+xml><i class="fa-solid fa-rss-square fa-3x"></i></a></li></ul><p>&copy; 2025. <a href=https://creativecommons.org/licenses/by-nc/4.0/>CC BY-NC 4.0</a></p></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=/blog/a-survey-of-robots-txt-part-one/>A survey of robots.txt - part one</a></h1><span class=post-date>Sep 19, 2017 &#183; 3 minute read</span><p>After reading <a href=https://www.kaggle.com/colinmorris/unusual-favicons-a-brief-survey>CollinMorris&rsquo;s analysis of favicons</a> of the top 1 million sites on the web, I thought it would be interesting to do the same for other common parts of websites that often get overlooked.</p><p>The <code>robots.txt</code> file is a plain text file found at on most websites which communicates information to web crawlers and spiders about how to scan a website.. For example, here&rsquo;s an excerpt from <code>robots.txt</code> for <code>google.com</code></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-txt data-lang=txt><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>User-agent: *
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Disallow: /search
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>Allow: /search/about
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>Allow: /search/howsearchworks
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>...
</span></span></code></pre></div><p>The above excerpt tells all web crawlers not to scan the <code>/search</code> path, but allows them to scan <code>/search/about</code> and <code>/search/howsearchworks</code> paths. There are a few more supported keywords, but these are the most common. Following these instructions is not required, but it is considered good internet etiquette. If you want to read more about the standard, Wikipedia has a great page <a href=https://en.wikipedia.org/wiki/Robots_exclusion_standard>here</a>.</p><p>In order to do an analysis of <code>robots.txt</code>, first I need to crawl the web for them â€“ ironic, I know.</p><h2 id=scraping>Scraping</h2><p>I wrote a scraper using <a href=https://scrapy.org/>scrapy</a> to make a request for <code>robots.txt</code> for each of the domains in Alexa&rsquo;s top 1 million websites. If the response code was 200, the <code>Content-Type</code> header contained <code>text/plain</code>, and the response body was not empty, I stored the response body in a file, with the same name as the domain name.</p><p>One complication I encountered was that not all domains respond on the same protocol or subdomain. For example, some websites respond on <code>http://{domain_name}</code> while others require <code>http://www.{domain_name}</code>. If a website doesn&rsquo;t automatically redirect you to the correct protocol or subdomain, the only way to find the correct one, is to try them all! So I wrote a small class, extending scrapy&rsquo;s <code>RetryMiddleware</code>, to do this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>COMMON_PREFIXES <span style=color:#0550ae>=</span> <span style=color:#1f2328>{</span><span style=color:#0a3069>&#39;http://&#39;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#39;https://&#39;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#39;http://www.&#39;</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#39;https://www.&#39;</span><span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#cf222e>class</span> <span style=color:#1f2328>PrefixRetryMiddleware</span><span style=color:#1f2328>(</span>RetryMiddleware<span style=color:#1f2328>):</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#cf222e>def</span> <span style=color:#6639ba>process_exception</span><span style=color:#1f2328>(</span><span style=color:#6a737d>self</span><span style=color:#1f2328>,</span> request<span style=color:#1f2328>,</span> exception<span style=color:#1f2328>,</span> spider<span style=color:#1f2328>):</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>            prefixes_tried <span style=color:#0550ae>=</span> request<span style=color:#0550ae>.</span>meta<span style=color:#1f2328>[</span><span style=color:#0a3069>&#39;prefixes&#39;</span><span style=color:#1f2328>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>            <span style=color:#cf222e>if</span> COMMON_PREFIXES <span style=color:#0550ae>==</span> prefixes_tried<span style=color:#1f2328>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>                <span style=color:#cf222e>return</span> exception
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>            new_prefix <span style=color:#0550ae>=</span> choice<span style=color:#1f2328>(</span><span style=color:#6639ba>tuple</span><span style=color:#1f2328>(</span>COMMON_PREFIXES <span style=color:#0550ae>-</span> prefixes_tried<span style=color:#1f2328>))</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>            request <span style=color:#0550ae>=</span> <span style=color:#6a737d>self</span><span style=color:#0550ae>.</span>update_request<span style=color:#1f2328>(</span>request<span style=color:#1f2328>,</span> new_prefix<span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>            <span style=color:#cf222e>return</span> <span style=color:#6a737d>self</span><span style=color:#0550ae>.</span>_retry<span style=color:#1f2328>(</span>request<span style=color:#1f2328>,</span> exception<span style=color:#1f2328>,</span> spider<span style=color:#1f2328>)</span>
</span></span></code></pre></div><p>The rest of the scraper itself is quite simple, but you can read the full code <a href=https://github.com/JamieMagee/robots-txt>on GitHub</a>.</p><h2 id=results>Results</h2><p>Scraping the full Alexa top 1 million websites list took around 24 hours. Once it was finished, I had just under 700k robots.txt files</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ find -type f <span style=color:#1f2328>|</span> wc -l
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#0550ae>677686</span>
</span></span></code></pre></div><p>totalling 493MB</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ du -sh
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>493M    .
</span></span></code></pre></div><p>The smallest <code>robots.txt</code> was 1 byte<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, but the largest was over 5MB.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ find -type f -exec du -Sh <span style=color:#0550ae>{}</span> + <span style=color:#1f2328>|</span> sort -rh <span style=color:#1f2328>|</span> head -n <span style=color:#0550ae>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>5.6M    ./haberborsa.com.tr
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>$ find -not -empty -type f -exec du -b <span style=color:#0550ae>{}</span> + <span style=color:#1f2328>|</span> sort -h <span style=color:#1f2328>|</span> head -n <span style=color:#0550ae>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#0550ae>1</span>    ./0434.cc
</span></span></code></pre></div><p>The full data set is released under the <a href=https://opendatacommons.org/licenses/odbl/1.0/>Open Database License (ODbL) v1.0</a> and can be found <a href=https://github.com/JamieMagee/robots-txt>on GitHub</a></p><h2 id=whats-next>What&rsquo;s next?</h2><p>In the next part of this blog series I&rsquo;m going to analyse all the <code>robots.txt</code> to see if I can find anything interesting. In particular I&rsquo;d like to know why exactly someone needs a <code>robots.txt</code> file over 5MB in size, what is the most common web crawler listed (either allowed or disallowed), and are there any sites practising security by obscurity by trying to keep links out of search engines!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>I needed to include <code>-not -empty</code> when looking for the smallest file, as there were errors when decoding the response body for some domains. I&rsquo;ve included the empty files in the dataset for posterity, but I will exclude them from further analysis.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post><h1 class=post-title><a href=/blog/setting-up-nginx-reverse-proxy-with-lets-encrypt-on-unraid/>Setting up nginx reverse proxy with Let&rsquo;s Encrypt on unRAID</a></h1><span class=post-date>Mar 28, 2016 &#183; 3 minute read</span><p>Late last year I set about building a new NAS to replace my aging HP ProLiant MicroServer N36L (though that&rsquo;s a story for a different post). I decided to go with unRAID as my OS, over FreeNAS that I&rsquo;d been running previously, mostly due to the simpler configuration, ease of expanding an array, and support for Docker and KVM.</p><p>Docker support makes it a lot easier to run some of the web apps that I rely on like Plex, Sonarr, CouchPotato and more, but accessing them securely outside my network is a different story. On FreeNAS I ran an nginx reverse proxy in a BSD jail, secured using basic auth, and SSL certificates from <a href=https://www.startssl.com/>StartSSL</a>. Thankfully there is already a Docker image, <a href=https://hub.docker.com/r/jwilder/nginx-proxy/>nginx-proxy</a> by jwilder, which automatically configures nginx for you. As for SSL, <a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a> went into public beta in December, and recently issued their millionth certificate. There&rsquo;s also a Docker image which will automatically manage your certificates, and configure nginx for you - <a href=https://hub.docker.com/r/jrcs/letsencrypt-nginx-proxy-companion/>letsencrypt-nginx-proxy-companion</a> by jrcs.</p><h2 id=preparation>Preparation</h2><p>Firstly, you need to set up and configure Docker. There is a fantastic guide on how to configure Docker <a href=https://lime-technology.com/docker-guide/>here</a> on the Lime Technology website. Next, you need to install the <a href="https://lime-technology.com/forum/index.php?topic=40262.0">Community Applications</a> plugin. This allows us to install Docker containers directly from the Docker Hub.</p><p>In order to access everything from outside your LAN you&rsquo;ll need to forward ports 80 and 443 to ports 8008 and 443, respectively, on your unRAID host. In addition, you&rsquo;ll need to use some sort of Dynamic DNS service, though in my case I bought a domain name and use CloudFlare to handle my DNS.</p><h2 id=nginx>nginx</h2><p>From the Apps page on the unRAID web interface, search for <code>nginx-proxy</code> and click &lsquo;get more results from Docker Hub&rsquo;. Click &lsquo;add&rsquo; under the listing for <code>nginx-proxy</code> by jwilder. Set the following container settings, changing your &lsquo;host path&rsquo; to wherever you store Docker configuration files on your unRAID host</p><p><img src=/img/nginx-proxy-settings.png alt="nginx-proxy settings"></p><p>To add basic auth to any of the sites you&rsquo;ll need to make a file with the <code>VIRTUAL_HOST</code> of the site, available to nginx in <code>/etc/nginx/htpasswd</code>. For example, I added a file in <code>/mnt/user/docker/nginx/htpasswd/</code>. You can create htpasswd files using <code>apache2-utils</code>, or there are sites available which can create them.</p><h2 id=lets-encrypt>Let&rsquo;s Encrypt</h2><p>From the Apps page again, search for <code>letsencrypt-nginx-proxy-companion</code>, click &lsquo;get more results from Docker Hub&rsquo;, and then click &lsquo;add&rsquo; under the listing for <code>letsencrypt-nginx-proxy-companion</code> by jrcs. Enter the following container settings, again changing your &lsquo;host path&rsquo; to wherever you store Docker configuration files on your unRAID host</p><p><img src=/img/lets-encrypt-settings.png alt="lets encrypt settings"></p><h2 id=putting-it-all-together>Putting it all together</h2><p>In order to configure nginx, you&rsquo;ll need to add four environment variables to the Docker containers you wish to put behind the reverse proxy. They are <code>VIRTUAL_HOST</code>, <code>VIRTUAL_PORT</code>, <code>LETSENCRYPT_HOST</code>, and <code>LETSENCRYPT_EMAIL</code>. <code>VIRTUAL_HOST</code> and <code>LETSENCRYPT_HOST</code> most likely need to be the same, and will be something like <code>subdomain.yourdomain.com</code>. <code>VIRTUAL_PORT</code> should be the port your Docker container exposes. For example, Sonarr uses port 8989 by default. <code>LETSENCRYPT_EMAIL</code> should be a valid email address that Let&rsquo;s Encrypt can use to email you about certificate expiries, etc.</p><p>Once <code>nginx-proxy</code>, <code>letsencrypt-nginx-proxy-companion</code>, and all your Docker containers are configured you should be able to access them all over SSL, with basic auth, from outside your LAN. You don&rsquo;t even have to worry about certificate renewals as it&rsquo;s all handled for you.</p></div><div class=post><h1 class=post-title><a href=/blog/do-you-want-bank-grade-ssl-danish-edition/>Do you really want &ldquo;bank grade&rdquo; security in your SSL? Danish edition</a></h1><span class=post-date>May 6, 2015 &#183; 4 minute read</span><p>I recently saw an article on <a href=https://www.reddit.com/r/programming>/r/programming</a> called <a href=https://www.troyhunt.com/do-you-really-want-bank-grade-security/>Do you really want &ldquo;bank grade&rdquo; security in your SSL? Here&rsquo;s how Aussie banks fare</a>. The author used the <a href=https://www.ssllabs.com/ssltest/>Qualys SSL Labs test</a> to determine how good Aussie banks&rsquo; SSL implementations really are. I thought the article was great, and gave good, actionable feedback. At the time of writing this two of the banks listed have already improved their SSL scores.</p><p>It got me thinking: how well (or badly) do banks in Denmark fare? We put our trust - and our money - in these banks, but do they really deserve it? The banks I&rsquo;ll be testing come from the <a href=https://en.wikipedia.org/wiki/List_of_systemically_important_banks>list of systemically important banks</a>, more commonly known as &ldquo;Too big to fail.&rdquo; The list consists of:</p><ul><li>Danske Bank</li><li>Nykredit</li><li>Nordea</li><li>Jyske Bank</li><li>Sydbank</li><li>DLR Kredit</li></ul><p>The Qualys SSL Labs test gives an overall grade, from A to F, but also points out any pressing issues with the SSL configuration. To score well a site must:</p><ul><li>Disable SSL 3 protocol support as it is obselete and insecure</li><li>Support TLS 1.2 as it is the current best protocol</li><li>Have no SHA1 certificates (excluding the root certificate) in the chain as modern browsers will show the site as insecure</li><li>Disable the RC4 cipher as it is a weak cipher</li><li>Support forward secrecy to prevent a compromise of a secure key affecting the confidentiality of past conversations</li><li>Mitigate POODLE attacks, to prevent attackers downgrading secure connections to insecure connections</li></ul><p>To make this as realistic as possible, I&rsquo;ll be testing the login pages.</p><p>So I&rsquo;ve got my list of sites, and my test all sorted. Let&rsquo;s dive right in!</p><table><thead><tr><th>Bank</th><th>Grade</th><th>SSL 3</th><th>TLS 1.2</th><th>SHA1</th><th>RC4</th><th>Forward Secrecy</th><th>POODLE</th></tr></thead><tbody><tr><td><a href="https://www.ssllabs.com/ssltest/analyze.html?d=danskebank.dk">Danske Bank</a></td><td>A-</td><td>Pass</td><td>Pass</td><td>Pass</td><td>Pass</td><td>Fail</td><td>Pass</td></tr><tr><td><a href="https://www.ssllabs.com/ssltest/analyze.html?d=netbank.nordea.dk">Nordea</a></td><td>B</td><td>Pass</td><td>Fail</td><td>Fail<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></td><td>Fail</td><td>Fail</td><td>Pass</td></tr><tr><td><a href="https://www.ssllabs.com/ssltest/analyze.html?d=dlr.dk">DLR Kredit</a></td><td>C</td><td>Fail</td><td>Fail</td><td>Fail</td><td>Fail</td><td>Fail</td><td>Fail<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></td></tr><tr><td><a href="https://www.ssllabs.com/ssltest/analyze.html?d=portal.jyskebank.dk">Jyske Bank</a></td><td>F</td><td>Pass</td><td>Fail</td><td>Pass</td><td>Fail</td><td>Fail</td><td>Fail</td></tr><tr><td><a href="https://www.ssllabs.com/ssltest/analyze.html?d=portal4.sydbank.dk">Sydbank</a></td><td>F</td><td>Pass</td><td>Fail</td><td>Pass</td><td>Fail</td><td>Fail</td><td>Fail</td></tr><tr><td><a href="https://www.ssllabs.com/ssltest/analyze.html?d=mitnykredit.dk">Nykredit</a></td><td>F</td><td>Fail</td><td>Fail</td><td>Fail<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></td><td>Fail</td><td>Fail</td><td>Fail</td></tr></tbody></table><p>Only one bank, Danske Bank, managed to get an A (though it is an A-). This is mostly due to the lack of forward secrecy support. If they fix this they can increase their rating to an A. They are also the only bank to enable TLS 1.2 support, and disable the RC4 cipher.</p><p>Nordea comes in second, managing a B, with some very odd results. They only support the TLS 1.0 protocol, but the list of server preferred cipher suites starts with RC4 (which is insecure). The server also sent a certificate chain with an MD2 certificate in it!</p><p>DLR Kredit achieves a C, despite the fact they are vulnerable to POODLE, because only their SSL 3 implementation is vulnerable. Their certificate is signed using SHA1, but stranger still their server didn&rsquo;t send any intermediate certificates. DLR Kredit is also the only bank which is vulnerable to the CRIME attack. This allows an attacker to read secure cookies sent by the server. Disabling TLS compression is all that is required to mitigate this.</p><p>Jyske Bank and Sydbank appear to use the same server configuration as their results are equally bad. They both have disabled SSL 3, and have a complete certificate chain signed using SHA256, but fail on all other tests. In addition, both banks are intolerant to TLS versions, meaning if their websites are badly written they may stop working when new TLS versions comes out.</p><p>Finally we have Nykredit, who fares worst of all. Their server sent unnecessary certificates, signed using SHA1, which causes them to fail this test. They only support TLS 1.0 and SSL 3, but their server&rsquo;s preferred cipher is RC4. Most worrying is the lack of support for secure renegotiation. This vulnerability is nearly 5 years old, and allows a man-in-the-middle to inject arbitrary content to an encrypted session.</p><p>Overall it&rsquo;s not looking too good. A lot of Denmark&rsquo;s biggest banks are not as secure as they would have you believe. Many are vulnerable to a lot of different avenues of attack - the most worrying being POODLE. These results are similar to those in Troy Hunt&rsquo;s original article, and just go to show that just because something is &ldquo;bank grade&rdquo; doesn&rsquo;t necessarily mean that it&rsquo;s actually good.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Nordea&rsquo;s SSL certificate is SHA256, but they use an SHA1 intermediate certificate&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>DLR receives a C overall, as only its SSL implementations are vulnerable to POODLE, but not its TLS implementation&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Nykredit would pass, but they provide an unnecessary certificate which is signed using SHA1&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post><h1 class=post-title><a href=/blog/continuous-deployment-jekyll-to-azure/>Continuously deploy Jekyll to Azure Web Apps</a></h1><span class=post-date>Mar 31, 2015 &#183; 4 minute read</span><p>I&rsquo;ve been thinking about writing a blog for a while now, but there are just so many blogging platforms out there to choose from. I finally settled on Jekyll as it&rsquo;s really lightweight (compared to platforms like Wordpress), it has an active development community, and you can write all your articles in Markdown.</p><p>Many Jekyll users host their Jekyll sites through GitHub Pages, and there are a lot of advantages to this:</p><ul><li>Free web hosting</li><li>Built in version control</li><li>Continuous deployment</li></ul><p>However, the main disadvantage is that GitHub Pages runs Jekyll in safe mode. This means that it&rsquo;s not possible to extend Jekyll with plugins. There are some ways to avoid this restriction, but they&rsquo;re all awkward workarounds.</p><h2 id=a-solution>A solution</h2><p>I still wanted all the advantages GitHub Pages has, but with Jekyll plugins too. The solution was to use <a href=https://travis-ci.org>Travis</a> to build the Jekyll site and host it on <a href=https://azure.microsoft.com/en-us/services/app-service/web/>Azure Web Apps</a>. Travis is a continuous integration service that&rsquo;s free for open source projects to use, and I&rsquo;m going to use it to build my Jekyll site. Azure provides cheap, or even free, web hosting for websites and it&rsquo;s what I&rsquo;m familiar with.</p><h2 id=azure>Azure</h2><p>First of all you need to create an Azure Web App.</p><ul><li>Go to the <a href=https://portal.azure.com>Azure Portal</a></li><li>Click New > Compute > Web App > Quick Create</li><li>Enter the URL you want and select an app service plan</li></ul><p><img src=/img/azure-new-web-app.png alt="Azure new web app"></p><p>On the dashboard for your new web app, make a note of the FTP host name and your deployment credentials. If you&rsquo;ve forgotten your deployment credentials you can reset them from here as well.</p><h2 id=github>GitHub</h2><p>I know I said earlier that I didn&rsquo;t want to use GitHub, but I&rsquo;m not actually using GitHub Pages. Travis depends on <a href=https://developer.github.com/v3/repos/hooks/>GitHub Webhooks</a> in order to figure out when you push an update to your site and kick off a build. In addition to the standard Jekyll files you&rsquo;ll need to add a <code>.travis.yml</code> configuration file as well as a build and deploy script. My Travis configuration looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#0550ae>language</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>ruby<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#fff></span><span style=color:#0550ae>rvm</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#fff>  </span>- <span style=color:#0550ae>2.2</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#fff></span><span style=color:#0550ae>script</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#fff>  </span>- chmod +x script/build<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#fff>  </span>- ./script/build<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#fff></span><span style=color:#0550ae>after_success</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#fff>  </span>- chmod +x script/deploy<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#fff>  </span>- ./script/deploy<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#fff></span><span style=color:#0550ae>env</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#fff>  </span><span style=color:#0550ae>global</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#fff>    </span>- NOKOGIRI_USE_SYSTEM_LIBRARIES=true<span style=color:#fff>
</span></span></span></code></pre></div><p>Taking it section by section</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0550ae>language</span><span style=color:#1f2328>:</span><span style=color:#fff> </span>ruby<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff></span><span style=color:#0550ae>rvm</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>  </span>- <span style=color:#0550ae>2.2</span><span style=color:#fff>
</span></span></span></code></pre></div><p>This tells Travis that the project is Ruby based, and what version of Ruby to use - in this case Ruby 2.2.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0550ae>script</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span>- chmod +x script/build<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>  </span>- ./script/build<span style=color:#fff>
</span></span></span></code></pre></div><p>My build script in the <code>scripts</code> directory. This sets the execute flag, then executes it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0550ae>after_success</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span>- chmod +x script/deploy<span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>  </span>- ./script/deploy<span style=color:#fff>
</span></span></span></code></pre></div><p>If the build is successful, Travis will set the execute flag on the <code>deploy</code> script, then execute it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#0550ae>env</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#fff>  </span><span style=color:#0550ae>global</span><span style=color:#1f2328>:</span><span style=color:#fff>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#fff>    </span>- NOKOGIRI_USE_SYSTEM_LIBRARIES=true<span style=color:#fff>
</span></span></span></code></pre></div><p>I&rsquo;m using <code>html-proofer</code> to check all the links and images on my site, and this allows me to speed up the build time by using pre-installed libraries.</p><p>Now onto the <code>build</code> script. There&rsquo;s nothing terribly exciting here, just build the site and run <code>html-proofer</code> on it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>bundle <span style=color:#6639ba>exec</span> jekyll build
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>bundle <span style=color:#6639ba>exec</span> htmlproof ./_site
</span></span></code></pre></div><p>The real magic happens in the <code>deploy</code> script.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>sudo apt-get install -qq ncftp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>ncftp -u <span style=color:#0a3069>&#34;</span><span style=color:#953800>$USERNAME</span><span style=color:#0a3069>&#34;</span> -p <span style=color:#0a3069>&#34;</span><span style=color:#953800>$PASSWORD</span><span style=color:#0a3069>&#34;</span> <span style=color:#953800>$HOST</span><span style=color:#0a3069>&lt;&lt;EOF
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#0a3069>rm -rf site/wwwroot
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#0a3069>mkdir site/wwwroot
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#0a3069>quit
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#0a3069>EOF</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6639ba>cd</span> _site
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>ncftpput -R -v -u <span style=color:#0a3069>&#34;</span><span style=color:#953800>$USERNAME</span><span style=color:#0a3069>&#34;</span> -p <span style=color:#0a3069>&#34;</span><span style=color:#953800>$PASSWORD</span><span style=color:#0a3069>&#34;</span> <span style=color:#953800>$HOST</span> /site/wwwroot .
</span></span></code></pre></div><p>I&rsquo;m making use of a handy program called <code>ncftp</code> in order to deploy my site. Firstly Travis deletes the currently deployed site, then puts the generated Jekyll site on the FTP server.</p><h2 id=travis>Travis</h2><p>To put it all together you need to configure Travis builds for your GitHub repository, and set the environment variables to allow Travis to deploy to Azure:</p><ul><li>Go your your <a href=https://travis-ci.org/profile>Travis profile</a></li><li>Click the slider next to your Jekyll repository</li><li>Go to your <a href=https://travis-ci.org/repositories>repositories</a> and click on your Jekyll repository</li><li>Click Settings > Environment variables</li><li>Set environment variables for your Azure Web App where<ul><li><code>USERNAME</code> is <code>azure-web-app-name\\azure-deployment-username</code></li><li><code>PASSWORD</code> is <code>azure-deployment-password</code></li><li><code>HOST</code> is <code>ftp-server-name.ftp.azurewebsites.windows.net</code></li></ul></li></ul><p><img src=/img/travis-environment-variables.png alt='Travis environment variables"'></p><p>Remember that <code>USERNAME</code> requires a double backslash to escape the character in the terminal.</p><h2 id=putting-it-all-together>Putting it all together</h2><p>Now that everything is all configured all you need to do is push a commit to GitHub and wait. If everything is good you should see your Jekyll site deployed automatically to your Azure Web App - though if you&rsquo;re anything like me <code>html-proofer</code> will have picked up some broken links on your site!</p></div><div class=pagination><a class=pagination-item href=/page/4/>Newer</a>
<span class=pagination-item>Older</span></div></div></div></body></html>